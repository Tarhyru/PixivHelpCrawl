var te=Object.defineProperty,se=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var N=(s,e,t)=>e in s?te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,w=(s,e)=>{for(var t in e||(e={}))A.call(e,t)&&N(s,t,e[t]);if(M)for(var t of M(e))D.call(e,t)&&N(s,t,e[t]);return s},y=(s,e)=>se(s,re(e));var U=(s,e)=>{var t={};for(var r in s)A.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&M)for(var r of M(s))e.indexOf(r)<0&&D.call(s,r)&&(t[r]=s[r]);return t};var W=(s,e,t)=>(N(s,typeof e!="symbol"?e+"":e,t),t);import{r as a,P as c,R as C,j as p,G as ne,o as O,F as oe}from"./react-venders.669d625f.js";import{A as ie,p as $,a9 as q}from"./index.c8ca1af3.js";import{d as le}from"./css.520be33d.js";import{I as F,a as ae,l as ue}from"./index.b0ecaf29.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M856 376H648V168c0-8.8-7.2-16-16-16H168c-8.8 0-16 7.2-16 16v464c0 8.8 7.2 16 16 16h208v208c0 8.8 7.2 16 16 16h464c8.8 0 16-7.2 16-16V392c0-8.8-7.2-16-16-16zm-480 16v188H220V220h360v156H392c-8.8 0-16 7.2-16 16zm204 52v136H444V444h136zm224 360H444V648h188c8.8 0 16-7.2 16-16V444h156v360z"}}]},name:"block",theme:"outlined"},pe=ce,G=function(e,t){return a.exports.createElement(ie,$($({},e),{},{ref:t,icon:pe}))};G.displayName="BlockOutlined";var he=a.exports.forwardRef(G);class R extends a.exports.Component{constructor(e){super(e),this.scrollListener=this.scrollListener.bind(this),this.eventListenerOptions=this.eventListenerOptions.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this)}componentDidMount(){this.pageLoaded=this.props.pageStart,this.options=this.eventListenerOptions(),this.attachScrollListener()}componentDidUpdate(){if(this.props.isReverse&&this.loadMore){const e=this.getParentElement(this.scrollComponent);e.scrollTop=e.scrollHeight-this.beforeScrollHeight+this.beforeScrollTop,this.loadMore=!1}this.attachScrollListener()}componentWillUnmount(){this.detachScrollListener(),this.detachMousewheelListener()}isPassiveSupported(){let e=!1;const t={get passive(){e=!0}};try{document.addEventListener("test",null,t),document.removeEventListener("test",null,t)}catch{}return e}eventListenerOptions(){let e=this.props.useCapture;return this.isPassiveSupported()?e={useCapture:this.props.useCapture,passive:!0}:e={passive:!1},e}setDefaultLoader(e){this.defaultLoader=e}detachMousewheelListener(){let e=window;this.props.useWindow===!1&&(e=this.scrollComponent.parentNode),e.removeEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture)}detachScrollListener(){let e=window;this.props.useWindow===!1&&(e=this.getParentElement(this.scrollComponent)),e.removeEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),e.removeEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture)}getParentElement(e){const t=this.props.getScrollParent&&this.props.getScrollParent();return t!=null?t:e&&e.parentNode}filterProps(e){return e}attachScrollListener(){const e=this.getParentElement(this.scrollComponent);if(!this.props.hasMore||!e)return;let t=window;this.props.useWindow===!1&&(t=e),t.addEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture),t.addEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),t.addEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture),this.props.initialLoad&&this.scrollListener()}mousewheelListener(e){e.deltaY===1&&!this.isPassiveSupported()&&e.preventDefault()}scrollListener(){const e=this.scrollComponent,t=window,r=this.getParentElement(e);let n;if(this.props.useWindow){const l=document.documentElement||document.body.parentNode||document.body,i=t.pageYOffset!==void 0?t.pageYOffset:l.scrollTop;this.props.isReverse?n=i:n=this.calculateOffset(e,i)}else this.props.isReverse?n=r.scrollTop:n=e.scrollHeight-r.scrollTop-r.clientHeight;n<Number(this.props.threshold)&&e&&e.offsetParent!==null&&(this.detachScrollListener(),this.beforeScrollHeight=r.scrollHeight,this.beforeScrollTop=r.scrollTop,typeof this.props.loadMore=="function"&&(this.props.loadMore(this.pageLoaded+=1),this.loadMore=!0))}calculateOffset(e,t){return e?this.calculateTopPosition(e)+(e.offsetHeight-t-window.innerHeight):0}calculateTopPosition(e){return e?e.offsetTop+this.calculateTopPosition(e.offsetParent):0}render(){const L=this.filterProps(this.props),{children:t,element:r,hasMore:n,initialLoad:l,isReverse:i,loader:u,loadMore:h,pageStart:f,ref:m,threshold:x,useCapture:B,useWindow:P,getScrollParent:T}=L,b=U(L,["children","element","hasMore","initialLoad","isReverse","loader","loadMore","pageStart","ref","threshold","useCapture","useWindow","getScrollParent"]);b.ref=S=>{this.scrollComponent=S,m&&m(S)};const v=[t];return n&&(u?i?v.unshift(u):v.push(u):this.defaultLoader&&(i?v.unshift(this.defaultLoader):v.push(this.defaultLoader))),C.createElement(r,b,v)}}W(R,"propTypes",{children:c.node.isRequired,element:c.node,hasMore:c.bool,initialLoad:c.bool,isReverse:c.bool,loader:c.node,loadMore:c.func.isRequired,pageStart:c.number,ref:c.func,getScrollParent:c.func,threshold:c.number,useCapture:c.bool,useWindow:c.bool}),W(R,"defaultProps",{element:"div",hasMore:!1,initialLoad:!0,pageStart:0,ref:null,threshold:250,useWindow:!0,isReverse:!1,useCapture:!1,loader:null,getScrollParent:null});function _(){return _=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},_.apply(this,arguments)}function de(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s,I(s,e)}function I(s,e){return I=Object.setPrototypeOf||function(r,n){return r.__proto__=n,r},I(s,e)}var j=function(s){de(e,s);function e(){return s.apply(this,arguments)||this}var t=e.prototype;return t.getColumns=function(){var n=this.props,l=n.children,i=n.columnsCount,u=Array.from({length:i},function(){return[]});return C.Children.forEach(l,function(h,f){h&&C.isValidElement(h)&&u[f%i].push(h)}),u},t.renderColumns=function(){var n=this.props.gutter;return this.getColumns().map(function(l,i){return C.createElement("div",{key:i,style:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignContent:"stretch",flex:1,width:0,gap:n}},l.map(function(u){return u}))})},t.render=function(){var n=this.props,l=n.gutter,i=n.className,u=n.style;return C.createElement("div",{style:_({display:"flex",flexDirection:"row",justifyContent:"center",alignContent:"stretch",boxSizing:"border-box",width:"100%",gap:l},u),className:i},this.renderColumns())},e}(C.Component);j.propTypes={};j.defaultProps={columnsCount:3,gutter:"0",className:null,style:{}};var fe=1,me=function(){var e=a.exports.useState(!1),t=e[0],r=e[1];return a.exports.useEffect(function(){r(!0)},[]),t},ve=function(){var e=me(),t=a.exports.useState(0),r=t[0],n=t[1],l=a.exports.useCallback(function(){!e||n(window.innerWidth)},[e]);return a.exports.useEffect(function(){if(e)return window.addEventListener("resize",l),l(),function(){return window.removeEventListener("resize",l)}},[e,l]),r},z=function(e){var t=e.columnsCountBreakPoints,r=e.children,n=e.className,l=e.style,i=ve(),u=a.exports.useMemo(function(){var h=Object.keys(t).sort(function(m,x){return m-x}),f=h.length>0?t[h[0]]:fe;return h.forEach(function(m){m<i&&(f=t[m])}),f},[i,t]);return p("div",{className:n,style:l,children:C.Children.map(r,function(h,f){return C.cloneElement(h,{key:f,columnsCount:u})})})};z.propTypes={};z.defaultProps={columnsCountBreakPoints:{350:1,750:2,900:3},className:null,style:null};function Y(s){const{preId:e="pre",visible:t,current:r=0,setVisible:n,imgList:l}=s;return p("div",{style:{display:"none"},children:p(F.PreviewGroup,{preview:{visible:t,current:r,onVisibleChange:i=>n(i)},children:(()=>l.map((i,u)=>p(F,{src:i.previewUrl},`${e}-${i.id||u}`)))()})})}function ge(s,e){const t=ne(),{queryParams:r,queryFn:n,loading:l=!1,initialLoad:i=!1,pageParams:u,columnsCount:h,setColumnsCount:f}=s,[m,x]=a.exports.useState(4),B=h||m,P=f||x,[T,b]=a.exports.useState(!1),[v,L]=a.exports.useState(!1),[S,J]=a.exports.useState({visible:!1,current:0}),[K,Q]=a.exports.useState({visible:!1,current:0,preId:"count",imgList:[]}),[H,V]=a.exports.useState([]),E=a.exports.useRef((u==null?void 0:u.current)||{offset:0,limit:30});function k(o=d=>{V(g=>[...g,...d])}){const{offset:d,limit:g}=E.current,Z=y(w({},r.current?r.current:r),{offset:d,limit:g});return b(!0),n(Z).then(ee=>X(ee,o)).finally(()=>{b(!1)})}function X(o,d){if(o.contents&&Array.isArray(o.contents.illusts)){d(o.contents.illusts);const g=o.contents.num||o.contents.illusts.length;E.current.offset+=g,L(g>=E.current.limit)}else L(!1);return o}return a.exports.useImperativeHandle(e,()=>({setList:V,setHasMore:L,queryList:k})),a.exports.useEffect(()=>{const o=document.body.clientWidth;o>1400?P(4):o>900?P(3):o>750?P(2):P(1),i&&k(),E.current.offset=0},[]),O(oe,{children:[O(q,{spinning:l,style:{marginTop:"50px"},children:[O(R,{initialLoad:!1,loadMore:()=>{T||k()},hasMore:v,useWindow:!0,children:[p(z,{columnsCountBreakPoints:{0:B},children:p(j,{gutter:"5px",children:(()=>H.map(o=>p(ae,{src:o.previewUrl,title:O("div",{className:"flex justify-between items-center",onClick:()=>{ue({api:(()=>{const d={id:o.id};return g=>(d.like=g,le(d))})(),name:o.title})},children:[p("span",{className:"flex-1 truncate",children:o.title}),o.count>1&&p(he,{})]}),imgClick:()=>{t.push(`/detail/image/${o.id}`)}},o.id)))()})}),p(q,{style:{width:"100%",marginTop:"10px"},spinning:T},0)]}),!v&&H.length>0?p("div",{style:{width:"100%",textAlign:"center",marginTop:"15px"},children:"\u6CA1\u6709\u66F4\u591A\u4E86~"}):null]}),p(Y,y(w({},S),{imgList:H,setVisible:o=>{J(d=>y(w({},d),{visible:o}))}})),p(Y,y(w({},K),{setVisible:o=>{Q(d=>y(w({},d),{visible:o}))}}))]})}var be=a.exports.forwardRef(ge);const xe=[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4}],Se=[{label:30,value:30},{label:60,value:60},{label:90,value:90}];export{xe as C,be as I,Se as P};
