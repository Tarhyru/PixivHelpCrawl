var W=Object.defineProperty;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var K=(r,e,t)=>e in r?W(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,h=(r,e)=>{for(var t in e||(e={}))I.call(e,t)&&K(r,t,e[t]);if(S)for(var t of S(e))N.call(e,t)&&K(r,t,e[t]);return r};var k=(r,e)=>{var t={};for(var s in r)I.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&S)for(var s of S(r))e.indexOf(s)<0&&N.call(r,s)&&(t[s]=r[s]);return t};import{r as i,j as o,o as p,F as A}from"./react-venders.669d625f.js";import{U as E,a9 as R}from"./index.c8ca1af3.js";import{C as V}from"./index.b0ecaf29.js";import{m as B,n as $,P as j,o as w}from"./css.520be33d.js";import{B as H}from"./button.ce6ccd71.js";import{S as T}from"./index.f6b7cb7c.js";import{I as z}from"./index.407a8341.js";import{a as M}from"./index.21463f10.js";import{C as O,P as D,I as Q}from"./define.0d09205b.js";import"./RouteContext.0a09958b.js";import"./PortalWrapper.4cc9adbc.js";import"./UpOutlined.88269719.js";function U(r,e){let t=null;return(...s)=>{t&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)}}function b(r){const q=r,{fetchConfig:e}=q,t=k(q,["fetchConfig"]),{api:s,searchKey:l="search",transContents:u}=e,[a,f]=i.exports.useState([]),[m,n]=i.exports.useState(!1),[y,C]=i.exports.useState(!0),d=i.exports.useRef({offset:0,limit:15,[l]:void 0}),v=i.exports.useRef(!1),x=()=>(n(!0),C(!0),s(h({},d.current)).then(c=>{if(Array.isArray(c.contents)){const g=c.contents.map(u);g.length<15&&C(!1),d.current.offset===0?f(g):f(F=>[...F,...g])}}).finally(()=>{n(!1)})),P=i.exports.useCallback(U(c=>(d.current.offset=0,d.current[l]=c,x()),1e3),[]);return i.exports.useEffect(()=>{x()},[]),o(T,h({loading:m,showSearch:!0,mode:"multiple",allowClear:!0,options:a,filterOption:!1,onClear:()=>{d.current.offset=0,d.current[l]=void 0,x()},onSearch:c=>{P(c)},onPopupScroll:c=>{c.persist();const{target:g}=c;g.scrollTop+g.offsetHeight===g.scrollHeight&&y&&v.current===!1&&(d.current.offset=a.length,v.current=!0,x().finally(()=>{setTimeout(()=>{v.current=!1},200)}))},style:{minWidth:"200px"}},t))}function G(r){return o(b,h({mode:"multiple",fetchConfig:{api:B,transContents:function(e){const{id:t,name:s,imageCount:l}=e;return{value:t,label:`${s}(${l})`}}}},r))}function J(r){return o(b,h({mode:"multiple",fetchConfig:{api:$,transContents:function(e){const{id:t,name:s,translatedName:l,customName:u}=e;return{value:t,label:`${u||l||s}(${s})`}}}},r))}const X=["createTime","totalBookmarks","totalView","likeLevel"],Y=["and","or"],Z=["tag","author"],_=[1,3,5,7,9];function he(){return o(E.exports.KeepAlive,{id:"ImgStorage",cashKey:"ImgStorage",children:o(te,{})})}function L(t){var s=t,{keys:r}=s,e=k(s,["keys"]);const l=i.exports.useMemo(()=>r.map(u=>({label:u,value:u})),[r]);return o(T,h({options:l,style:{minWidth:"200px"}},e))}function ee(r){const{queryParams:e}=r;return p("div",{style:{minWidth:"280px"},children:[o(M,{defaultChecked:!0,onChange:t=>{t.target.checked?e.current.sanityMode="lt":e.current.sanityMode="eq"},children:"mode:lt"}),o(L,{keys:_,defaultValue:e.current.sanityLevel,onChange:t=>{t?e.current.sanityLevel=t:e.current.sanityLevel=5}})]})}function te(){const[r,e]=i.exports.useState(4),[t,s]=i.exports.useState(!1),[l,u]=i.exports.useState("tag"),a=i.exports.useRef({tags:[],filterTags:[],tagMode:"and",tagType:"tag",sanityMode:"lt",sortKey:"createTime",sortMode:"descend",sanityLevel:5,needFilter:!0}),f=i.exports.useRef({offset:0,limit:15}),m=i.exports.useRef();return o(j,{title:p("div",{className:"query-content",children:[p("div",{className:"query-item",style:{gap:"2px"},children:[o(L,{keys:Z,style:{minWidth:"80px"},defaultValue:a.current.tagType,onChange:n=>{u(n),n?a.current.tagType=n:a.current.tagType="tag"}}),l==="tag"?p(A,{children:[o(J,{style:{minWidth:"150px"},onChange:n=>{n?a.current.tags=n:a.current.tags=[]}}),o(L,{keys:Y,style:{minWidth:"80px"},defaultValue:a.current.tagMode,onChange:n=>{n?a.current.tagMode=n:a.current.tagMode="and"}})]}):o(G,{onChange:n=>{n?a.current.tags=n:a.current.tags=[]}})]}),p("div",{className:"query-item",children:[o(L,{keys:X,defaultValue:a.current.sortKey,onChange:n=>{n?a.current.sortKey=n:a.current.sortKey="createTime"}}),o(M,{defaultChecked:!0,onChange:n=>{n.target.checked?a.current.sortMode="descend":a.current.sortMode="ascend"},children:"mode:DESC"})]}),p("div",{className:"query-item",children:[o(ee,{queryParams:a}),o(M,{defaultChecked:!0,onChange:n=>{n.target.checked?a.current.needFilter=!0:a.current.needFilter=!1},children:"needFilter"})]}),p("div",{className:"query-item",children:[o(H,{type:"primary",onClick:()=>{f.current.offset=0,s(!0),m.current.queryList(n=>{m.current.setList(n)}).finally(()=>{s(!1)})},children:"\u67E5\u8BE2"}),o(T,{value:r,onChange:n=>{e(n)},options:O}),o(T,{defaultValue:f.current.limit,onChange:n=>{f.current.limit=n},options:D}),o(z,{onBlur:n=>{const y=Number(n.target.value);y&&(f.current.offset=y,s(!0),m.current.queryList(C=>{m.current.setList(C)}).finally(()=>{s(!1)}))}})]})]}),children:o(V,{className:"fall-content",size:"small",children:o(R,{spinning:t,children:o(Q,{ref:m,columnsCount:r,setColumnsCount:e,initialLoad:!0,queryParams:a,pageParams:f,queryFn:w})})})})}export{he as default};
